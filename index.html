<!doctype html>
<html lang="en">
  <head>
    <!--To-do: attack, section 4-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Text game</title>
    <style>
      body {
        background: #242424;
        height: 100vh;
        display: flex;
        justify-content: center;
        text-align: center;
        color: white;
        align-items: center;
        margin:0;
        padding:0;
      }
      p {
        color: white;
        overflow-wrap: break-word;
        margin: 10px;
      }
      input[type=button]{
        -webkit-appearance: none;
        margin: 5px;
        border-style: solid;
        border: gray;
      }
      #game{
        display: flex;
        border-style: solid;
        border-color: gray;
        padding: 10px;
        max-width:50%;
        height: 600px;
        justify-content: space-around;
        margin-top: 20px;
        flex-wrap: nowrap;
        flex-direction: row;
        flex-grow:3;
      }
      #actions{
        display:flex;
        flex-direction: column;
        max-width: 500px;
        min-width: 20px;
        margin-right: 10px;
        flex-shrink: 1;
        flex-grow: 1;
      }

      #game-container {
        width: 60%;
        max-width: 200vh;
        max-height: 600px;
        border: 2px solid gray;
        background-color: #000;
        padding: 20px;
        overflow-y: auto; /* Scrollable */
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        text-align: left;
      }
      #output {
          flex-grow: 1;
          white-space: pre-wrap; /* Preserves newlines */
          margin-bottom: 20px;
      }

      .choices{
        display:flex;
        flex-flow: row wrap;
        justify-content:center;
      }
      
    </style>
  </head>
  <body>
    <div id="game">
      <div id="game-container">
        <div id="output"></div>
      </div>
      <div id="actions">
        <p id="inventoryText">Inventory:</p>
        <div id="inventory"></div>
        <p id="keysText">Keys:</p>
        <div id="keys"></div>
        <p>Actions:</p>
        <div class="choices">
          <input type="button" id="1" onclick="buttonInput('1')" value="Look around">
          <input type="button" id="2" onclick="buttonInput('2')" value="Examine yourself">
          
          <input type="button" id="Look" onclick="buttonInput('Look')" value="Look">
          <input type="button" id="Place trap" onclick="buttonInput('Place trap')" value="Place trap">
          <input type="button" id="Unlock" onclick="buttonInput('Unlock')" value="Unlock">
          <input type="button" id="Get rope" onclick="buttonInput('Get rope')" value="Get rope">
          <input type="button" id="Get firewood" onclick="buttonInput('Get firewood')" value="Get firewood">
          <input type="button" id="(Action descriptions)" onclick="buttonInput('(Action descriptions)')" value="(Action descriptions)">
          
          <input type="button" id="Hide" onclick="buttonInput('Hide')" value="Hide">
          <input type="button" id="Wait" onclick="buttonInput('Wait')" value="Wait">
          <input type="button" id="Attack" onclick="buttonInput('Attack')" value="Attack">

          <input type="button" id="Play again" onclick="buttonInput('Play again')" value="Play again">
        </div>
        <p id="movementText">Movement:</p>
        <div class="choices">
          <input type="button" id="Trophy room" onclick="buttonInput('Trophy room')" value="Trophy room">
          <input type="button" id="Office" onclick="buttonInput('Office')" value="Office">
          <input type="button" id="Outside" onclick="buttonInput('Outside')" value="Outside">
          <input type="button" id="Entrance room" onclick="buttonInput('Entrance room')" value="Entrance room">
          <input type="button" id="Kitchen" onclick="buttonInput('Kitchen')" value="Kitchen">
          <input type="button" id="Bedroom" onclick="buttonInput('Bedroom')" value="Bedroom">
          <input type="button" id="Corridor" onclick="buttonInput('Corridor')" value="Corridor">
        </div>
        <p id="trapText">Trap options:</p>
        <div class="choices">
          <input type="button" id="Use rope" onclick="buttonInput('Use rope')" value="Use rope">
          <input type="button" id="Use taxidermized fox" onclick="buttonInput('Use taxidermized fox')" value="Use taxidermized fox">
          <input type="button" id="Use sharp knife" onclick="buttonInput('Use sharp knife')" value="Use sharp knife">
          <input type="button" id="Use fishing rod" onclick="buttonInput('Use fishing rod')" value="Use fishing rod">
          <input type="button" id="Use bottled water" onclick="buttonInput('Use bottled water')" value="Use bottled water">
          <input type="button" id="Use nothing" onclick="buttonInput('Use nothing')" value="Use nothing">
          <input type="button" id="Cancel" onclick="buttonInput('Cancel')" value="Cancel">
        </div>
      </div>
    </div>
    <script>
    // --- GAME VARIABLES (STATE) ---
    let gameState = {
        section: 1, // 1 = Intro, 2 = House, 3 = Host
        subState: "start",
        inventory: [],
        keys: [],
        room: "bedroom",
        time: 0, // Will be randomized in init
        survivalPoints: 0,
        
        // Flags
        seenIntroOne: false,
        seenIntroTwo: false,
        
        // Room Check Counts
        bedroomCheck: 0,
        officeCheck: 0,
        trophyCheck: 0,
        kitchenCheck: 0,
        
        // Unlocks
        officeUnlocked: false,
        trophyUnlocked: false,
        entranceUnlocked: false,
        
        // Descriptions seen
        officeSeen: false,
        corridorSeen: false,
        kitchenSeen: false,
        entranceSeen: false,
        trophySeen: false,

        // Traps
        makingTrap: false,
        trappedRooms:[],
        
        // Host Section
        reachedExit: false,
        playerActions: 2,
        hostPath: ["entrance room","corridor","bedroom","office","bedroom","corridor","kitchen","corridor","trophy room","corridor"],
        hostRoom: "none",
        hostRoomId: -1,
        hostStall: false,
        hostRepeat: false,
        injuries: 0,
        hiding: false,
        rifleUsed: false,
    };

    // --- UTILITY FUNCTIONS ---
    
    const outputDiv = document.getElementById('output');
    const inventoryDiv = document.getElementById('inventory');
    const keyDiv = document.getElementById('keys');

    function print(text) {
        // Appends text to the div
        outputDiv.innerHTML += text + "\n";
        // Auto scroll to bottom
        document.getElementById('game-container').scrollTop = document.getElementById('game-container').scrollHeight;
    }
    function updateInventory(text){
      gameState.inventory.push(text);
      inventoryDiv.innerHTML += text + ", ";
    }
    function removeItem(input){
      let idx = gameState.inventory.indexOf(input);
      gameState.inventory.splice(idx, 1);
      inventoryDiv.innerHTML = inventoryDiv.innerHTML.replace((input+", "),"");
      
    }
    function updateKeys(text){
      keyDiv.innerHTML += text + ", ";
      gameState.keys.push(text);
    }
    function startGame() {
        // Init Section 1
        gameState.inventory = [];
        gameState.keys = [];
        gameState.section=1;
        print("You wake up in an unfamiliar shack. You don't remember much of the past few days - got drunk with a few friends and decided to wander into the woods to get some fresh air away from the campfire. You suppose someone found you and brought you here. You feel something restricting your wrist.\n");
        print("1. Look around\n2. Examine yourself\n");
        hideButton("Look");
        hideButton("Place trap");
        hideButton("Unlock");
        hideButton("Get rope");
        hideButton("Get firewood");
        hideButton("movementText");
        hideButton("trapText");
        hideButton("inventoryText");
        hideButton("keysText");
        hideButton("Hide");
        hideButton("Wait");
        hideButton("Attack");
        hideButton("Play again");
        hideAllMovement();
        hideAllTraps();
    }

    // --- MAIN LOGIC ---

    function buttonInput(buttonValue) {
        let input = buttonValue;
        print("> " + input); // Echo user input

        // --- SECTION 1: INTRO ---
        if (gameState.section === 1) {

            if (input === "1") {
                print("\nThe shack is well lit with the still burning fireplace. The windows show only a blizzard. On the bedside table you see some food, as well as a fork and a knife. How nice of them.\n");
                gameState.seenIntroOne = true;
                if (gameState.seenIntroTwo) {
                    print("The knife seems somewhat sharp. The same can’t be said about whoever left you here. You take the knife and start cutting the rope...\n");
                    gameState.section = 2;
                    initSection2();
                }
            }
            else if (input === "2") {
                print("You seemed to be tied with a rope to the leg of the bed you're laying on. Not the best first impression of whoever found you. You think you should probably try to avoid an in-person meeting with them.\n");
                gameState.seenIntroTwo = true;
                if (gameState.seenIntroOne) {
                    print("Wait, wasn’t there a knife nearby? You wonder if it could cut the rope.\n");
                }
            }
            else if (input === "(Action descriptions)") {
                print("Available actions:\n1. Look around\n2. Examine yourself\n");
            }

            else {
                print("Not an option.\n");
            }
        }

        // --- SECTION 2: THE HOUSE ---
        else if (gameState.section === 2) {
            
            // Check trap making state first
            if (gameState.makingTrap) {
                handleTrapInput(input);
                return;
            }

            // Check Time
            if (gameState.time <= 0) {
                print("\nIt seems you are out of time...");
                gameState.section = 3;
                initSection3();
                return;
            }

            if (input === "Look") {
                handleLook();
            }

            else if(input === "Trophy room" || input === "Office" || input === "Outside" || input === "Entrance room" || input === "Kitchen" || input === "Bedroom" || input === "Corridor"){
              handleMovement(input);
            }

            // Handle the actual movement input
            else if (gameState.subState === "moving") {
                handleMovement(input);
                gameState.subState = ""; // Reset
            }
            else if (input === "Unlock") {
                handleUnlock();
            }
            else if (input === "Place trap") {
                initTrap();
            }
            // Specific Actions
            else if (input === "Get rope") {
                 if (gameState.inventory.includes("sharp knife")) {
                    print("You cut the rope with the sharp knife.");
                    updateInventory("rope");
                    gameState.time -= 1;
                } else {
                    print("You cut the rope with the small knife.");
                    updateInventory("rope");
                    gameState.time -= 5;
                }
                hideButton("Get rope");
                showButton("Get firewood");
            }
            else if ((input === "Get firewood") && gameState.room === "bedroom" && gameState.inventory.includes("rope")) {
                print("You tied the firewood together with the rope. Now you can carry it.");
                updateInventory("firewood");
                
            }
            else if (input === "(Action descriptions)"){
              showActions();
            }
            else {
                print("Not an option.\n");
            }
        }

        // --- SECTION 3: THE HOST ---
          
        else if (gameState.section === 3) {
          if(gameState.injuries>5){
            print("\nEverything hurts... You've been hit too many times. Your vision darkens...");
            print("(You lost... Try again?)");
            playAgain();
          }
          else if(gameState.playerActions===0){
            hostTurn();
          }
          else{
            if (input === "actions") {
                let actions = "\nAvailable actions:\n\"Move\" - Choose a room to move to. \n\"Attack\" - Attack the host with a weapon.\n\"Hide\" - Hide from the host.\n\"Wait\" - Skip one action.";
                print(actions);
            }
            else if(input === "Hide"){
                if((room === "corridor")){
                  print("Nowhere to hide here. (no actions taken)");
                }
                else{
                  print("You are now hiding.");
                  gameState.hiding=true;
                  gameState.playerActions--;
                }
            }
            else if(input === "Trophy room" || input === "Office" || input === "Outside" || input === "Entrance room" || input === "Kitchen" || input === "Bedroom" || input === "Corridor"){
              handleMovement(input);
              gameState.playerActions--;
              gameState.hiding=false;
              if(gameState.room === gameState.hostRoom){
                print("As you open the door you see a tall figure searching around the room.");
                hostTurn();
              }
            }

            else if (input === "Wait") {
                print("You wait.");
                gameState.playerActions--;
            }
            /*else if(input === "Attack"){
              
            }*/
            else if(input === "Play again"){
              startGame();
            }
            else {
                print("Not an option");
            }
          }
        }
    }

    // --- HELPER LOGIC FUNCTIONS ---

    function initSection2() {
        print("After some time you manage to free yourself. The wind is howling outside. The blizzard seems to have worsened since you got here. Even if you get out of the house, you would need some supplies to simply not die of the cold, not to mention even finding your way. You think you can \"borrow\" some stuff from this property before their owner comes back, whenever that is...\n");
        hideButton("1");
        hideButton("2");
        showButton("Look");
        showButton("Place trap");
        showButton("Corridor");
        showButton("Get rope");
        showButton("movementText");
        showButton("inventoryText");
        showButton("keysText");
        print("\nSECTION 2: THE HOUSE\n");
        gameState.time = Math.floor(Math.random() * 31) + 10;
        print("Now that you're not tied to the bed, you can gather your surrounding better. There are two doors leading out of the room. One of them is labeled \"Office\". It seems to be locked. The other is unlabeled and unlocked.\n");
        
        updateInventory("food");
        updateInventory("small knife");
        print("(Tutorial: You have a certain amount of time before host returns. You do not know how much that is. You can spend this time [min] to do certain actions. To see what the actions do and how much time they take, press the (Action descriptions) button.");
    }

    function handleLook() {
        if (gameState.room === "bedroom") {
            if (gameState.bedroomCheck === 0) {
                print("You have found an entrance key, lighter, and some firewood. You cannot get firewood yet, because you need rope to tie it so that you can carry it.");
                print("(When you get the rope, the choice to collect the firewood should appear)");
                print("Other than that, you think you found everything here.");
                updateKeys("entrance key");
                updateInventory("lighter");
                gameState.bedroomCheck++;
                gameState.time -= 5;
                gameState.survivalPoints += 1;
            } else {
                print("Nothing to look for here. (No time used up)");
            }
        }
        else if (gameState.room === "office") {
            if (gameState.officeCheck === 0) {
                print("You have found a trophy room key, a fishing rod and bait. You feel like you have missed some things... Maybe you should have a look again sometime?");
                updateKeys("trophy room key");
                updateInventory("fishing rod");
                updateInventory("bait");
                gameState.officeCheck++;
                gameState.time -= 5;
                gameState.survivalPoints += 2;
            } else if (gameState.officeCheck === 1) {
                print("You have found a few blank pieces of paper, a map of the surrounding area, and a firearm locker key. You think you found everything here.");
                updateInventory("paper");
                updateInventory("map of the surroundings");
                updateKeys("firearm locker key");
                gameState.officeCheck++;
                gameState.time -= 5;
                gameState.survivalPoints += 3;
            } else {
                print("Nothing to look for here. (No time used up)");
            }
        }
        else if (gameState.room === "trophy") {
             if (gameState.trophyCheck === 0) {
                  print("You have found a firearm locker, but you're goint to need to use a key in your actions to unlock it...");
                  print("You have also found a taxidermied fox! Sure, not a very surprising find in this room, but something about it seems very... entrancing...");
                  print("After staring at it for a straight minute, you break out of it. Whatever this thing actually is, you think you can use it for a trap or distraction.\n");
                 updateInventory("taxidermied fox?");
                 gameState.trophyCheck++;
                 gameState.time -= 6;
             } else {
                 print("Nothing to look for here. (No time used up)");
             }
        }
        else if (gameState.room === "kitchen") {
            if (gameState.kitchenCheck === 0) {
                print("You have found an office key, and a sharp knife. You feel like you have missed some things... Maybe you should have a look again sometime?");
                updateInventory("sharp knife");
                updateKeys("office key");
                gameState.kitchenCheck++;
                gameState.time -= 5;
                gameState.survivalPoints += 2;
            } else if (gameState.kitchenCheck === 1) {
                print("You found bottled water and raw meat.");
                if(gameState.inventory.includes("firewood")) {
                    print("You think you could cook it with the firewood you found.");
                    gameState.survivalPoints += 2;
                }
                else print("The meat will be useless if you dont have any firewood to cook it on though. You think you found everything here.");
                updateInventory("bottled water");
                updateInventory("raw meat");
                gameState.kitchenCheck++;
                gameState.time -= 5;
                gameState.survivalPoints += 1;
            } else {
                print("Nothing to look for here. (No time used up)");
            }
        }
        else {
            print("Nothing to look for here. (No time used up)");
        }
    }

    function showActions() {
        print("\nAvailable actions:\n\"Look\" - [5 min] Search room.\n\"Move\" - Change room.\n\"Trap\" - [10 min] Place trap.");
        if (gameState.room === "bedroom") {
            if (gameState.inventory.includes("sharp knife")) print("\"Get rope\" - [1min] Cut off some of the rope. Now that you have a sharper knife, you can do it quicker.");
            else print("\"Get rope\" - [5min] Cut off some of the rope. Useful, but will take a while to cut with such a small knife.");
            if (gameState.bedroomCheck === 1) print("\"Firewood\" - [3min] get the firewood. Rope is needed to tie it together if you want to carry it.");
            if (gameState.keys.includes("office key")) print("\"Unlock\" - Unlock the office.");
        }
        if (gameState.room === "corridor" && gameState.keys.includes("trophy room key")) print("\"Unlock\" - Unlock the trophy room.");
        if (gameState.room === "trophy" && gameState.keys.includes("firearm locker key") && gameState.trophyCheck === 1) print("\"Unlock\" - Unlock the firearm locker.");
        if (gameState.room === "entrance" && gameState.keys.includes("entrance key")) print("\"Unlock\" - Unlock the entrance door.");
    }

    function updateButtons(){
      if (gameState.room === "bedroom") {
        if(!(gameState.inventory.includes("rope") || gameState.inventory.includes("firewood")))showButton("Get rope");
        else hideButton("Get rope");
        if (gameState.bedroomCheck === 1 && gamestate.inventory.includes("rope") && (!(gameState.inventory.includes("firewood")))) showButton("Get firewood");
        else hideButton("Get firewood");
        if (gameState.keys.includes("office key")) showButton("Unlock");
        else hideButton("Unlock");
      }
      else if (gameState.room === "corridor" && gameState.keys.includes("trophy room key")){
        showButton("Unlock");
        hideButton("Get rope");
        hideButton("Get firewood");
      }
      else if (gameState.room === "trophy" && gameState.keys.includes("firearm locker key") && gameState.trophyCheck === 1){
        showButton("Unlock");
        hideButton("Get rope");
        hideButton("Get firewood");
      }
      else if (gameState.room === "entrance" && gameState.keys.includes("entrance key")){
        showButton("Unlock");
        hideButton("Get rope");
        hideButton("Get firewood");
      }
      else{
        hideButton("Unlock");
        hideButton("Get rope");
        hideButton("Get firewood");
      }
    }

    function handleMovement(dest) {
        dest = dest.toLowerCase();
        
        // Boilerplate movement logic
        if (dest === "stay") {
             print("You stayed in the same room.\n");
             return;
        }

        let moved = false;
        
        if (dest === "bedroom") {
            if (["corridor", "office", "bedroom"].includes(gameState.room)) {
                gameState.room = "bedroom";
                print("You moved to the bedroom.");
                moved = true;
                hideAllMovement();
                showButton("Corridor");
                if(gameState.officeUnlocked) showButton("Office");
            }
        }
        else if (dest === "corridor") {
            if (["bedroom", "trophy", "kitchen", "entrance", "corridor"].includes(gameState.room)) {
                gameState.room = "corridor";
                print("You moved to the corridor.");
                if (!gameState.corridorSeen) {
                    print("The corridor is dark but not too long. Surprisingly empty too. Unless there are any secret compartments here, you doubt you could find anything worthwhile. There are four doors, all labeled. What is this person's deal with labeling rooms?");
                    gameState.corridorSeen = true;
                }
                moved = true;
                hideAllMovement();
                showButton("Bedroom");
                showButton("Kitchen");
                showButton("Entrance room");
                if(gameState.trophyUnlocked)showButton("Trophy room");
            }
        }
        else if (dest === "office") {
            if (gameState.officeUnlocked && ["bedroom", "office"].includes(gameState.room)) {
                gameState.room = "office";
                print("You moved to the office.");
                if (!gameState.officeSeen) {
                    print("When you enter the room, the first things you notice are the strong smell of dust and mountains of papers scattered about. Many of them seem to be personal documents of various different people... There is also a variety of equipment for hunting and fishing. No guns though, sadly. There are no doors except for the one you entered through.");
                    gameState.officeSeen = true;
                }
                moved = true;
                hideAllMovement();
                showButton("Bedroom");
            }
        }
        else if (dest === "trophy room") {
            if (gameState.trophyUnlocked && ["corridor", "trophy"].includes(gameState.room)) {
                gameState.room = "trophy";
                print("You moved to the trophy room.");
                if (!gameState.trophySeen) {
                    print("Mounted animal heads. So many of them. You don't think there is an inch of a wall that doesn't have one or some other kind of hunting trophy. A few cabinets are placed haphazardly around the room, as well as pedestals with full-body taxidermied animals. Even the chandelier is made of deer antlers. You can't tell if the host absolutely loves or hates animals, but they seem to feel very strongly about it.");
                    gameState.trophySeen = true;
                }
                moved = true;
                hideAllMovement();
                showButton("Corridor");
            }
        }
        else if (dest === "kitchen") {
             if (["corridor", "kitchen"].includes(gameState.room)) {
                gameState.room = "kitchen";
                print("You moved to the kitchen.");
                if (!gameState.kitchenSeen) {
                    print("A normal kitchen - fridge, counters, a sink, some cabinets. There is a strong smell of raw meat, so you doubt you will find anything else here.");
                    gameState.kitchenSeen = true;
                }
                moved = true;
                 hideAllMovement();
                 showButton("Corridor");
             }
        }
        else if (dest === "entrance room") {
            if (["corridor", "entrance"].includes(gameState.room)) {
                gameState.room = "entrance";
                print("You moved to the entrance room.");
                if (!gameState.entranceSeen) {
                  print("It is quite barren, but not the the same extent the corridor is. There are a few chairs, a table, and a chandelier at least. You notice that the only window in the room has a circular pattern of cracks on it, almost like a spiderweb. It seems it has been shot at once, and has turned out to be bullet proof. You think it is safe to assume that all of the other windows are reinforced too, meaning that the only exit is the door here.");
                  print("You try the handle of the front door. It's locked. Sadly, it seems your captor actually does have some sense in them. You push a chair up against it. Just in case.\n");
                  gameState.entranceSeen = true;
                }
                moved = true;
                hideAllMovement();
                showButton("Corridor");
                if(gameState.entranceUnlocked) showButton("Outside");

            }
        }
        else if (dest === "outside") {
            if (gameState.entranceUnlocked && gameState.room === "entrance") {
                print("You got out of the house.");
                gameState.reachedExit = true;
                gameState.section = 3;
                hideAllMovement();
                initSection3();
                return;
            }
        }

        if (!moved) {
            print("Can't go there right now.");
        }
        updateButtons();
    }

    function handleUnlock() {
        if (gameState.room === "bedroom" && gameState.keys.includes("office key")) {
            print("Office unlocked.");
            gameState.officeUnlocked = true;
            updateButtons();
        } else if (gameState.room === "corridor" && gameState.keys.includes("trophy room key")) {
            print("Trophy room unlocked.");
            gameState.trophyUnlocked = true;
            updateButtons();
        } else if (gameState.room === "trophy" && gameState.keys.includes("firearm locker key")) {
            print("Firearm locker unlocked. Inside is a loaded rifle. You pick up the rifle. You feel safer.");
            updateInventory("loaded rifle");
            updateButtons();
        } else if (gameState.room === "entrance" && gameState.keys.includes("entrance key")) {
            print("Entrance door unlocked.");
            gameState.entranceUnlocked = true;
            updateButtons();
            
        } else {
            print("Nothing to unlock.");
        }
    }

    function initTrap() {
        print("Setting a trap takes 10 minutes. Or 3 minutes if you use an item:");
        showButton("trapText");
        if (gameState.inventory.includes("rope")) showButton("Use rope");
        if (gameState.inventory.includes("taxidermied fox?")) showButton("Use taxidermied fox");
        if (gameState.inventory.includes("sharp knife")) showButton("Use sharp knife");
        if (gameState.inventory.includes("fishing rod")) showButton("Use fishing rod");
        if (gameState.inventory.includes("bottled water")) showButton("Use bottled water");
        showButton("Use nothing");
        showButton("Cancel");
        
        print("Type the item name, or 'none'.");
        gameState.makingTrap = true;
    }

    function handleTrapInput(input) {
        input = input.substring(4);
        if(gameState.trappedRooms.includes(gameState.room)){
          print("There is already a trap set in this room. You doubt you could place more without making it difficult to move through yourself, so you abandon the idea.");
        }
        else{
          if (input === "nothing") {
            print("You set a trap manually.");
            gameState.time -= 10;
            print("Trap set in " + gameState.room);
            gameState.trappedRooms.push(gameState.room);
          } else if (gameState.inventory.includes(input)) {
              
              removeItem(input);
              print("You used " + input + " for a trap.");
              gameState.time -= 3;
          } else {
              print("You can't use this item.");
          }
        }
        gameState.makingTrap = false;
        hideAllTraps();
        hideButton("trapText");
    }
    function initSection3() {
        if (!gameState.reachedExit) {
            gameState.entranceUnlocked=true;
            print("Right as you finished doing this, you hear someone ");
            if(gameState.entranceSeen){
              print("try to open the entrance door, the chair you set up blocking their way.");
            }
            else {
              print("open the entrance door, fumbling with their keys for a few moments.");
            }
            print("It seems you are out of time. You need to get out of here. Although… maybe you are able to put up a fight with the host?\n");
            print("\nSECTION 3: THE HOST\n");
            showButton("Hide");
            showButton("Wait");
            showButton("Attack");
            hideButton("Look");
            hideButton("Trap");
            hideButton("(Action descriptions)");
            print("(Tutorial: You start before the host. On your turn, you can use two available actions before the host, including moving to a different room (Your options have changed. To see the new actions, press the (Action descriptions) button). Either reach the entrance room and try your chances at surviving outside with what you have, or fight the host. If you manage to defeat them, you are guaranteed to survive the wilderness.");
            print("If the host notices you being in the same room as them, they will injure you. Injuries lower your chances of traversing the wilderness alive, but you get one more action immediately after receiving one. Talk about adrenaline!)");
        } else {
            print("\nCONGRATULATIONS!");
            print("You escaped the house successfully!");
            print("Final Survival Points: " + gameState.survivalPoints);
        }
    }
    function hostTurn() {
      if(gameState.hostStall===true){
        print("The host is stalled. They will not act right now.");
        gameState.hostStall=false;
      }
      else{
        if (!(gameState.room===gameState.hostRoom)) {
          print("You hear the host shuffle around the house...");
          gameState.hostRoomId++;
          if(gameState.hostRoomId>9){
            gameState.hostRoomId=0;
            gameState.hostRepeat=true;
          }
          gameState.hostRoom=gameState.hostPath[gameState.hostRoomId];
          if(gameState.trappedRooms.includes(gameState.hostRoom)){
            print("The host set off a trap!");
            gameState.hostStall=true;
            gameState.trappedRooms=gameState.trappedRooms.splice(gameState.hostRoomId);
          }
        }
        if(gameState.room===gameState.hostRoom){
          if(gameState.hiding){
            if(repeat===false) print("You manage to avoid the host. Their eyes don't fall on your hiding spot.");
            else{
              if((Math.floor(Math.random()*50))>65){
                print("Your hiding spot fails\n");
                print("You are noticed and the figure quickly moves toward you and attacks you! You feel a burst of pain and adrenaline.(You gain an aditional action for 1 turn)\n");
                gameState.playerActions+=1;
                gameState.injuries+=1;
                gameState.hiding=false;
              }
              else print("You manage to avoid the host. Their eyes don't fall on your hiding spot.");
            }
          }
          else{
            print("You are noticed and the figure quickly moves toward you and attacks you! You feel a burst of pain and adrenaline.(You gain an aditional action for 1 turn)");
            gameState.playerActions+=1;
            gameState.injuries+=1;
          }
        }
      }
      gameState.playerActions = 2;
    }

    function hideButton(ButtonId) {
    document.getElementById(ButtonId).style.display = "none";
    }

    function showButton(ButtonId) {
    document.getElementById(ButtonId).style.display = "inline-block";
    }
    function hideAllMovement(){
      hideButton("Entrance room");
      hideButton("Trophy room");
      hideButton("Kitchen");
      hideButton("Bedroom");
      hideButton("Office");
      hideButton("Corridor");
      hideButton("Outside");
    }
    function hideAllTraps(){
      hideButton("Use rope");
      hideButton("Use taxidermized fox");
      hideButton("Use sharp knife");
      hideButton("Use fishing rod");
      hideButton("Use bottled water");
      hideButton("Use nothing");
      hideButton("Cancel");
    }
    function playAgain(){
      hideAllMovement();
      hideButton("Hide");
      hideButton("Wait");
      hideButton("Attack");
      print("Play again?");
      showButton("Play again");
      
    }
      
    // Start
    startGame();
    
</script>
  </body>
</html>
